!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs")):"function"==typeof define&&define.amd?define(["fs"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).CCapture=e(t.fs)}(this,(function(t){"use strict";if(t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){for(var i=atob(this.toDataURL(e,n).split(",")[1]),r=i.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=i.charCodeAt(s);t(new Blob([o],{type:e||"image/png"}))}}),
// @license http://opensource.org/licenses/MIT
"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}function n(t){return String("0000000"+t).slice(-7)}function i(t){var e={};this.settings=t,this.on=function(t,n){e[t]=n},this.emit=function(t){var n=e[t];n&&n.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),this.extension="",this.mimeType=""}i.prototype.start=function(){},i.prototype.stop=function(){},i.prototype.add=function(){},i.prototype.save=function(){},i.prototype.dispose=function(){},i.prototype.safeToProceed=function(){return!0},i.prototype.step=function(){console.log("Step not set!")};var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return s(null==e&&n.path)}},n.exports),n.exports}function s(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var a=o((function(t,e){t.exports=function t(e,n,i){function r(a,h){if(!n[a]){if(!e[a]){if(!h&&s)return s();if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[a]={exports:{}};e[a][0].call(l.exports,(function(t){var n=e[a][1][t];return r(n||t)}),l,l.exports,t,e,n,i)}return n[a].exports}for(var o=s,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,a,h,f;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(s(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),i=(f=n.slice()).length,h=0;h<i;h++)f[h].apply(this,a);return!0},i.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var n,i,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var i,r,o,s,a;a=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),o="ie"===(i=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===i[1]?i[3]:i[1],version:o||parseFloat("opera"===i[1]&&i[4]?i[4]:i[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,e.exports=r},{}],3:[function(t,e,n){var i,r,o,s={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},h=[].slice;i=t("events").EventEmitter,o=t("./browser.coffee"),r=function(t){var e,n;function i(t){var n,i,r;for(i in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)r=e[i],null==(n=this.options)[i]&&(n[i]=r)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,t),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},i.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},i.prototype.setOptions=function(t){var e,n,i;for(e in n=[],t)s.call(t,e)&&(i=t[e],n.push(this.setOption(e,i)));return n},i.prototype.addFrame=function(t,e){var i,r;for(r in null==e&&(e={}),(i={}).transparent=this.options.transparent,n)i[r]=e[r]||n[r];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},i.prototype.render=function(){var t,e,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,n;for(n=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)n.push(null);return n}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,n=e;0<=n?t<n:t>n;0<=n?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},i.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)this.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},i.prototype.spawnWorkers=function(){var t,e,n,i;return t=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var i=e=this.freeWorkers.length;e<=t?i<t:i>t;e<=t?i++:i--)n.push(i);return n}.apply(this).forEach((i=this,function(t){var e;return i.log("spawning worker "+t),(e=new Worker(i.options.workerScript)).onmessage=function(t){return i.activeWorkers.splice(i.activeWorkers.indexOf(e),1),i.freeWorkers.push(e),i.frameFinished(t.data)},i.freeWorkers.push(e)})),t},i.prototype.frameFinished=function(t){var e,n;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,n=this.freeWorkers.length;1<=n?e<n:e>n;1<=n?++e:--e)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},i.prototype.finishRendering=function(){var t,e,n,i,r,o,s,a,h,f,l,u,c,d,p,m;for(a=0,r=0,h=(d=this.imageParts).length;r<h;r++)a+=((e=d[r]).data.length-1)*e.pageSize+e.cursor;for(a+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),t=new Uint8Array(a),u=0,o=0,f=(p=this.imageParts).length;o<f;o++)for(n=s=0,l=(m=(e=p[o]).data).length;s<l;n=++s)c=m[n],t.set(c,u),n===e.data.length-1?u+=e.cursor:u+=e.pageSize;return i=new Blob([t],{type:"image/gif"}),this.emit("finished",i,t)},i.prototype.renderNextFrame=function(){var t,e,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(e)},i.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},i.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},i.prototype.getTask=function(t){var e,n;if(n={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===o.name},null!=t.data)n.data=t.data;else if(null!=t.context)n.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");n.data=this.getImageData(t.image)}return n},i.prototype.log=function(){var t;if(t=1<=arguments.length?h.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},i}(i),e.exports=r},{"./browser.coffee":2,events:1}]},{},[3])(3)}));function h(t){i.call(this,t),t.quality=31-(30*t.quality/100||10),t.workers=t.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new a({workers:t.workers,quality:t.quality,workerScript:t.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){var e=this.callback;e&&(this.callback=void 0,e(t))}.bind(this))}h.prototype=Object.create(i.prototype),h.prototype.add=function(t){this.sizeSet||(this.encoder.setOption("width",t.width),this.encoder.setOption("height",t.height),this.sizeSet=!0),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.drawImage(t,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},h.prototype.save=function(t){this.callback=t,this.encoder.render()};var f=o((function(t){!function(){let e=function(t){this.data=new Uint8Array(t),this.pos=0};e.prototype.seek=function(t){this.pos=t},e.prototype.writeBytes=function(t){for(let e=0;e<t.length;e++)this.data[this.pos++]=t[e]},e.prototype.writeByte=function(t){this.data[this.pos++]=t},e.prototype.writeU8=e.prototype.writeByte,e.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},e.prototype.writeDoubleBE=function(t){let e=new Uint8Array(new Float64Array([t]).buffer);for(let t=e.length-1;t>=0;t--)this.writeByte(e[t])},e.prototype.writeFloatBE=function(t){let e=new Uint8Array(new Float32Array([t]).buffer);for(let t=e.length-1;t>=0;t--)this.writeByte(e[t])},e.prototype.writeString=function(t){for(let e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},e.prototype.writeEBMLVarIntWidth=function(t,e){switch(e){case 1:this.writeU8(128|t);break;case 2:this.writeU8(64|t>>8),this.writeU8(t);break;case 3:this.writeU8(32|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(16|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(8|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new Error("Bad EBML VINT size "+e)}},e.prototype.measureEBMLVarInt=function(t){if(t<127)return 1;if(t<16383)return 2;if(t<2097151)return 3;if(t<268435455)return 4;if(t<34359738367)return 5;throw new Error("EBML VINT size not supported "+t)},e.prototype.writeEBMLVarInt=function(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))},e.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new Error("Bad UINT size "+e)}},e.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},e.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw new Error("ArrayBufferDataStream's pos lies beyond end of buffer")},t.exports=e}()})),l=o((function(e){e.exports=function(t){return function(e){let n=[],i=Promise.resolve(),r=null,o=null;function s(t){return new Promise((function(e,n){let i=new FileReader;i.addEventListener("loadend",(function(){e(i.result)})),i.readAsArrayBuffer(t)}))}function a(t){return new Promise((function(e,n){t instanceof Uint8Array?e(t):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e(new Uint8Array(t)):t instanceof Blob?e(s(t).then((function(t){return new Uint8Array(t)}))):e(s(new Blob([t])).then((function(t){return new Uint8Array(t)})))}))}function h(t){let e=t.byteLength||t.length||t.size;if(!Number.isInteger(e))throw new Error("Failed to determine size of element");return e}e&&"FileWriter"===e.constructor.name?r=e:t&&e&&(o=e),this.pos=0,this.length=0,this.seek=function(t){if(t<0)throw new Error("Offset may not be negative");if(isNaN(t))throw new Error("Offset may not be NaN");if(t>this.length)throw new Error("Seeking beyond the end of file is not allowed");this.pos=t},this.write=function(e){let s={offset:this.pos,data:e,length:h(e)},f=s.offset>=this.length;this.pos+=s.length,this.length=Math.max(this.length,this.pos),i=i.then((function(){if(o)return new Promise((function(e,n){a(s.data).then((function(n){let i=0,r=Buffer.from(n.buffer),a=function(n,r,h){i+=r,i>=h.length?e():t.write(o,h,i,h.length-i,s.offset+i,a)};t.write(o,r,0,r.length,s.offset,a)}))}));if(r)return new Promise((function(t,e){r.onwriteend=t,r.seek(s.offset),r.write(new Blob([s.data]))}));if(!f)for(let t=0;t<n.length;t++){let e=n[t];if(!(s.offset+s.length<=e.offset||s.offset>=e.offset+e.length)){if(s.offset<e.offset||s.offset+s.length>e.offset+e.length)throw new Error("Overwrite crosses blob boundaries");return s.offset==e.offset&&s.length==e.length?void(e.data=s.data):a(e.data).then((function(t){return e.data=t,a(s.data)})).then((function(t){s.data=t,e.data.set(s.data,s.offset-e.offset)}))}}n.push(s)}))},this.complete=function(t){return i=o||r?i.then((function(){return null})):i.then((function(){let e=[];for(let t=0;t<n.length;t++)e.push(n[t].data);return new Blob(e,{type:t})})),i}}}(t)})),u=o((function(t){!function(){function e(t,e){return function(t){if("string"!=typeof t||!t.match(/^data:image\/webp;base64,/i))throw new Error("Failed to decode WebP Base64 URL");return window.atob(t.substring("data:image/webp;base64,".length))}("string"==typeof t&&/^data:image\/webp/.test(t)?t:t.toDataURL("image/webp",e))}function n(t){let e=t.indexOf("VP8",12);if(-1===e)throw new Error("Bad image format, does this browser support WebP?");let n=!1;for(;e<t.length-8;){let r,o;switch(o=t.substring(e,e+4),e+=4,r=((i=t.substring(e,e+4)).charCodeAt(0)|i.charCodeAt(1)<<8|i.charCodeAt(2)<<16|i.charCodeAt(3)<<24)>>>0,e+=4,o){case"VP8 ":return{frame:t.substring(e,e+r),hasAlpha:n};case"ALPH":n=!0}e+=r,0!=(1&r)&&e++}var i;throw new Error("Failed to find VP8 keyframe in WebP image, is this image mistakenly encoded in the Lossless WebP format?")}function i(t){this.value=t}function r(t){this.value=t}function o(t,e,n){if(Array.isArray(n))for(let i=0;i<n.length;i++)o(t,e,n[i]);else if("string"==typeof n)t.writeString(n);else if(n instanceof Uint8Array)t.writeBytes(n);else{if(!n.id)throw new Error("Bad EBML datatype "+typeof n.data);if(n.offset=t.pos+e,t.writeUnsignedIntBE(n.id),Array.isArray(n.data)){let i,r,s;-1===n.size?t.writeByte(255):(i=t.pos,t.writeBytes([0,0,0,0])),r=t.pos,n.dataOffset=r+e,o(t,e,n.data),-1!==n.size&&(s=t.pos,n.size=s-r,t.seek(i),t.writeEBMLVarIntWidth(n.size,4),t.seek(s))}else if("string"==typeof n.data)t.writeEBMLVarInt(n.data.length),n.dataOffset=t.pos+e,t.writeString(n.data);else if("number"==typeof n.data)n.size||(n.size=t.measureUnsignedInt(n.data)),t.writeEBMLVarInt(n.size),n.dataOffset=t.pos+e,t.writeUnsignedIntBE(n.data,n.size);else if(n.data instanceof r)t.writeEBMLVarInt(8),n.dataOffset=t.pos+e,t.writeDoubleBE(n.data.value);else if(n.data instanceof i)t.writeEBMLVarInt(4),n.dataOffset=t.pos+e,t.writeFloatBE(n.data.value);else{if(!(n.data instanceof Uint8Array))throw new Error("Bad EBML datatype "+typeof n.data);t.writeEBMLVarInt(n.data.byteLength),n.dataOffset=t.pos+e,t.writeBytes(n.data)}}}let s=function(t,i){return function(s){let a,h,f=!1,l=0,u=0,c=null,d=null,p=null,m=[],g=0,w=0,y={quality:.95,transparent:!1,alphaQuality:void 0,fileWriter:null,fd:null,frameDuration:null,frameRate:null},v={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},b={id:17545,data:new r(0)},k=[],E=new i(s.fileWriter||s.fd);function x(t){return t-a.dataOffset}function L(){h=function(){let t={id:21420,size:5,data:0},e={id:290298740,data:[]};for(let n in v){let i=v[n];i.positionEBML=Object.create(t),e.data.push({id:19899,data:[{id:21419,data:i.id},i.positionEBML]})}return e}();let e={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},b]},n=[{id:176,data:l},{id:186,data:u}];s.transparent&&n.push({id:21440,data:1});let i={id:374648427,data:[{id:174,data:[{id:215,data:1},{id:29637,data:1},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:n}]}]};a={id:408125543,size:-1,data:[h,e,i]};let r=new t(256);o(r,E.pos,[{id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},a]),E.write(r.getAsDataArray()),v.SegmentInfo.positionEBML.data=x(e.offset),v.Tracks.positionEBML.data=x(i.offset),f=!0}function B(e){return e.alpha?function(e){let n,i,r=new t(4);if(!(e.trackNumber>0&&e.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return r.writeEBMLVarInt(e.trackNumber),r.writeU16BE(e.timecode),r.writeByte(0),n={id:161,data:[r.getAsDataArray(),e.frame]},i={id:30113,data:[{id:166,data:[{id:238,data:1},{id:165,data:e.alpha}]}]},{id:160,data:[n,i]}}(e):function(e){let n=new t(4);if(!(e.trackNumber>0&&e.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return n.writeEBMLVarInt(e.trackNumber),n.writeU16BE(e.timecode),n.writeByte(128),{id:163,data:[n.getAsDataArray(),e.frame]}}(e)}function A(){if(0===m.length)return;let e=0;for(let t=0;t<m.length;t++)e+=m[t].frame.length+(m[t].alpha?m[t].alpha.length:0);let n=new t(e+64*m.length),i=function(t){return{id:524531317,data:[{id:231,data:Math.round(t.timecode)}]}}({timecode:Math.round(g)});for(let t=0;t<m.length;t++)i.data.push(B(m[t]));var r,s,a;o(n,E.pos,i),E.write(n.getAsDataArray()),r=1,s=Math.round(g),a=i.offset,k.push({id:187,data:[{id:179,data:s},{id:183,data:[{id:247,data:r},{id:241,data:x(a)}]}]}),m=[],g+=w,w=0}this.addFrame=function(t,i,r){f||(l=t.width||0,u=t.height||0,L());let o,a=n(e(t,s.quality)),h=null;o=r||("number"==typeof i?i:s.frameDuration),s.transparent&&(i instanceof HTMLCanvasElement||"string"==typeof i?h=i:a.hasAlpha&&(h=function(t){null!==c&&c.width===t.width&&c.height===t.height||(c=document.createElement("canvas"),c.width=t.width,c.height=t.height,d=c.getContext("2d"),p=d.createImageData(c.width,c.height));let e=t.getContext("2d").getImageData(0,0,t.width,t.height).data,n=p.data,i=0,r=t.width*t.height*4;for(let t=3;t<r;t+=4){let r=e[t];n[i++]=r,n[i++]=r,n[i++]=r,n[i++]=255}return d.putImageData(p,0,0),c}(t))),function(t){t.trackNumber=1,t.timecode=Math.round(w),m.push(t),w+=t.duration,w>=5e3&&A()}({frame:a.frame,duration:o,alpha:h?n(e(h,s.alphaQuality)).frame:null})},this.complete=function(){return f||L(),A(),function(){let e={id:475249515,data:k},n=new t(16+32*k.length);o(n,E.pos,e),E.write(n.getAsDataArray()),v.Cues.positionEBML.data=x(e.offset)}(),function(){let e=new t(h.size),n=E.pos;o(e,h.dataOffset,h.data),E.seek(h.dataOffset),E.write(e.getAsDataArray()),E.seek(n)}(),function(){let e=new t(8),n=E.pos;e.writeDoubleBE(g),E.seek(b.dataOffset),E.write(e.getAsDataArray()),E.seek(n)}(),E.complete("video/webm")},this.getWrittenSize=function(){return E.length},s=function(t,e){let n={};return[t,e].forEach((function(t){for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])})),n}(y,s||{}),function(){if(!s.frameDuration){if(!s.frameRate)throw new Error("Missing required frameDuration or frameRate setting");s.frameDuration=1e3/s.frameRate}s.quality=Math.max(Math.min(s.quality,.99999),0),void 0===s.alphaQuality?s.alphaQuality=s.quality:s.alphaQuality=Math.max(Math.min(s.alphaQuality,.99999),0)}()}};t.exports=s(f,l)}()}));function c(t){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),i.call(this,t),this.quality=t.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=t.framerate,this.frames=0,this.part=1,this.videoWriter=new u({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}c.prototype=Object.create(i.prototype),c.prototype.start=function(t){this.dispose()},c.prototype.add=function(t){this.videoWriter.addFrame(t),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+n(this.part),download(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+n(this.part),this.step()}.bind(this)):(this.frames++,this.step())},c.prototype.save=function(t){this.videoWriter.complete().then(t)},c.prototype.dispose=function(t){this.frames=0,this.videoWriter=new u({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})},r.FFMpegServer={Video:function(){
/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var t,e,n;return function(i){var r,o,s,a,h={},f={},l={},u={},c=Object.prototype.hasOwnProperty,d=[].slice,p=/\.js$/;function m(t,e){return c.call(t,e)}function g(t,e){var n,i,r,o,s,a,h,f,u,c,d,m=e&&e.split("/"),g=l.map,w=g&&g["*"]||{};if(t&&"."===t.charAt(0))if(e){for(s=(t=t.split("/")).length-1,l.nodeIdCompat&&p.test(t[s])&&(t[s]=t[s].replace(p,"")),t=m.slice(0,m.length-1).concat(t),u=0;u<t.length;u+=1)if("."===(d=t[u]))t.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((m||w)&&g){for(u=(n=t.split("/")).length;u>0;u-=1){if(i=n.slice(0,u).join("/"),m)for(c=m.length;c>0;c-=1)if((r=g[m.slice(0,c).join("/")])&&(r=r[i])){o=r,a=u;break}if(o)break;!h&&w&&w[i]&&(h=w[i],f=u)}!o&&h&&(o=h,a=f),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function w(t,e){return function(){var n=d.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),o.apply(void 0,n.concat([t,e]))}}function y(t){return function(e){h[t]=e}}function v(t){if(m(f,t)){var e=f[t];delete f[t],u[t]=!0,r.apply(void 0,e)}if(!m(h,t)&&!m(u,t))throw new Error("No "+t);return h[t]}function b(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function k(t){return function(){return l&&l.config&&l.config[t]||{}}}s=function(t,e){var n,i=b(t),r=i[0];return t=i[1],r&&(n=v(r=g(r,e))),r?t=n&&n.normalize?n.normalize(t,function(t){return function(e){return g(e,t)}}(e)):g(t,e):(r=(i=b(t=g(t,e)))[0],t=i[1],r&&(n=v(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:n}},a={require:function(t){return w(t)},exports:function(t){var e=h[t];return void 0!==e?e:h[t]={}},module:function(t){return{id:t,uri:"",exports:h[t],config:k(t)}}},r=function(t,e,n,i){var r,o,l,c,d,p,g=[],b=typeof n;if(i=i||t,"undefined"===b||"function"===b){for(e=!e.length&&n.length?["require","exports","module"]:e,d=0;d<e.length;d+=1)if("require"===(o=(c=s(e[d],i)).f))g[d]=a.require(t);else if("exports"===o)g[d]=a.exports(t),p=!0;else if("module"===o)r=g[d]=a.module(t);else if(m(h,o)||m(f,o)||m(u,o))g[d]=v(o);else{if(!c.p)throw new Error(t+" missing "+o);c.p.load(c.n,w(i,!0),y(o),{}),g[d]=h[o]}l=n?n.apply(h[t],g):void 0,t&&(r&&void 0!==r.exports&&r.exports!==h[t]?h[t]=r.exports:void 0===l&&p||(h[t]=l))}else t&&(h[t]=n)},t=e=o=function(t,e,n,i,h){if("string"==typeof t)return a[t]?a[t](e):v(s(t,e).f);if(!t.splice){if((l=t).deps&&o(l.deps,l.callback),!e)return;e.splice?(t=e,e=n,n=null):t=void 0}return e=e||function(){},"function"==typeof n&&(n=i,i=h),i?r(void 0,t,e,n):setTimeout((function(){r(void 0,t,e,n)}),4),o},o.config=function(t){return o(t)},t._defined=h,(n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),m(h,t)||m(f,t)||(f[t]=[t,e,n])}).amd={jQuery:!0}}(),n("node_modules/almond/almond.js",(function(){})),n("src/virtualsocket",[],(function(){return function(t){var e,n=!0===(t=t||{}).quiet?console.log.bind(console):function(){},i=t.url||"ws://"+window.location.host;n("connecting to: "+i),e=new WebSocket(i),this.__defineGetter__("readyState",(function(){return e.readyState})),this.isConnected=function(){return e.readyState===WebSocket.OPEN};var r=function(t){e.readyState===WebSocket.OPEN&&e.send(t)};this.on=function(t,n){switch(t){case"connect":e.onopen=n;break;case"disconnect":e.onclose=n;break;case"error":e.onerror=n;break;case"message":e.onmessage=function(t){if("P"!==t.data){try{var e=JSON.parse(t.data)}catch(t){console.log(t)}e&&n(e)}else r("P")}}},this.send=function(t){r(JSON.stringify(t))},this.close=function(){e.close()}}})),n("src/frameencoder",["./virtualsocket"],(function(t){return function(e){var n,i=(e=e||{}).quiet?function(){}:console.log.bind(console),r={},o=function(t,e){var n=r[t];n&&n.apply(this,e)}.bind(this);this.addEventListener=function(t,e){r[t]=e},this.on=this.addEventListener,this.removeEventListener=function(t){r[t]=void 0},this.start=function(t){a({cmd:"start",data:t})},this.add=function(t){a({cmd:"frame",data:{dataURL:t.toDataURL()}})},this.end=function(){a({cmd:"end"})};var s=function(){i("connected"),o("connect")}.bind(this);(n=e.socket||new t(e)).on("connect",s.bind(this)),n.on("message",function(t){var e=r[t.cmd];e?e(t.data):console.error("Unknown Message: "+t.cmd)}.bind(this)),n.on("disconnect",function(){i("disconnected"),o("disconnect")}.bind(this));var a=function(t){n.isConnected()&&n.send(t)}}})),n("src/ffmpegserver",["./frameencoder"],(function(t){return function(e){(e=e||{}).url=e.url||function(){for(var t={"ffmpegserver.js":!0,"ffmpegserver.min.js":!0},e=document.getElementsByTagName("script"),n=0;n<e.length;++n){var i=e[n],r=i.src,o=r.lastIndexOf("/");if(o>=0&&(r=r.substr(o+1)),t[r])return"ws://"+new URL(i.src).host}}();var n,i=new t(e),r=0,o=0,s=e.maxQueuedFrames||4,a=!1,h={};function f(){return a&&r-o<s}function l(t){var e=h[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}function u(){f()&&l("process")}this.start=function(t){n=t||{}},this.add=function(t){++r,i.add(t)},this.end=function(){i.end()},this.on=function(t,e){h[t]=e},this.safeToProceed=f,i.on("start",(function(t){a=!0,i.start(n),u()})),i.on("error",(function(t){console.error(t),l("error",t)})),i.on("end",(function(t){l("finished",t.pathname,t.size)})),i.on("frame",(function(t){o=Math.max(o,t.frameNum),u()})),i.on("progress",(function(t){l("progress",t.progress)}))}})),n("main",["src/ffmpegserver"],(function(t){return t})),e(["main"],(function(t){return t}),void 0,!0),n("build/js/includer",(function(){})),e("main")}()};var d={};function p(t){i.call(this,t),t.quality=t.quality/100||.8,this.encoder=new d.Video(t),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(t,e){var n=this.callback;n&&(this.callback=void 0,n(t,e))}.bind(this)),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("error",function(t){alert(JSON.stringify(t,null,2))}.bind(this))}p.prototype=Object.create(i.prototype),p.prototype.start=function(){this.encoder.start(this.settings)},p.prototype.add=function(t){this.encoder.add(t)},p.prototype.save=function(t){this.callback=t,this.encoder.end()},p.prototype.safeToProceed=function(){return this.encoder.safeToProceed()};var m=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function g(t){var e,n=new Uint8Array(t);for(e=0;e<t;e+=1)n[e]=0;return n}var w={clean:g,pad:function(t,e,n){return t=t.toString(n||8),"000000000000".substr(t.length+12-e)+t},extend:function(t,e,n,i){var r=g((parseInt((e+n)/i)+1)*i);return r.set(t),r},stringToUint8:function(t,e,n){var i,r;for(e=e||g(t.length),n=n||0,i=0,r=t.length;i<r;i+=1)e[n]=t.charCodeAt(i),n+=1;return e},uint8ToBase64:function(t){var e,n,i,r,o=t.length%3,s="";for(e=0,i=t.length-o;e<i;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],s+=m[(r=n)>>18&63]+m[r>>12&63]+m[r>>6&63]+m[63&r];switch(s.length%4){case 1:s+="=";break;case 2:s+="=="}return s}},y=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}];const v={structure:y,format:function(t,e){var n=w.clean(512),i=0;return y.forEach((function(e){var r,o,s=t[e.field]||"";for(r=0,o=s.length;r<o;r+=1)n[i]=s.charCodeAt(r),i+=1;i+=e.length-r})),"function"==typeof e?e(n,i):n}};var b;function k(t){this.written=0,b=512*(t||20),this.out=w.clean(b),this.blocks=[],this.length=0}function E(t){i.call(this,t),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.baseFilename=this.filename,this.tape=null,this.count=0,this.part=1,this.frames=0}function x(t){E.call(this,t),this.type="image/png",this.fileExtension=".png"}function L(t){E.call(this,t),this.type="image/jpegs",this.fileExtension=".jpg",this.quality=t.quality/100||.8}function B(t){i.call(this,t),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}k.prototype.append=function(t,e,n,i){var r,o,s,a,h,f,l;if("string"==typeof e)e=w.stringToUint8(e);else if(e.constructor!==Uint8Array.prototype.constructor)throw"Invalid input type. You gave me: "+e.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/)[1];"function"==typeof n&&(n={}),s=(n=n||{}).mode||4095&parseInt("777",8),a=n.mtime||Math.floor(+new Date/1e3),h=n.uid||0,f=n.gid||0,r={fileName:t,fileMode:w.pad(s,7),uid:w.pad(h,7),gid:w.pad(f,7),fileSize:w.pad(e.length,11),mtime:w.pad(a,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:n.owner||"",group:n.group||""},o=0,Object.keys(r).forEach((function(t){var e,n,i=r[t];for(e=0,n=i.length;e<n;e+=1)o+=i.charCodeAt(e)})),r.checksum=w.pad(o,6)+"\0 ",l=v.format(r);var u=512*Math.ceil(l.length/512),c=512*Math.ceil(e.length/512);this.blocks.push({header:l,input:e,headerLength:u,inputLength:c})},k.prototype.save=function(){var t=[],e=[],n=0,i=Math.pow(2,20),r=[];return this.blocks.forEach((function(t){n+t.headerLength+t.inputLength>i&&(e.push({blocks:r,length:n}),r=[],n=0),r.push(t),n+=t.headerLength+t.inputLength})),e.push({blocks:r,length:n}),e.forEach((function(e){var n=new Uint8Array(e.length),i=0;e.blocks.forEach((function(t){n.set(t.header,i),i+=t.headerLength,n.set(t.input,i),i+=t.inputLength})),t.push(n)})),t.push(new Uint8Array(1024)),new Blob(t,{type:"octet/stream"})},k.prototype.clear=function(){this.written=0,this.out=w.clean(b)},E.prototype=Object.create(i.prototype),E.prototype.start=function(){this.dispose()},E.prototype.add=function(t){var e=new FileReader;e.onload=function(){this.tape.append(n(this.count)+this.fileExtension,new Uint8Array(e.result)),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+n(this.part),download(t,this.filename+this.extension,this.mimeType);var e=this.count;this.dispose(),this.count=e+1,this.part++,this.filename=this.baseFilename+"-part-"+n(this.part),this.frames=0,this.step()}.bind(this)):(this.count++,this.frames++,this.step())}.bind(this),e.readAsArrayBuffer(t)},E.prototype.save=function(t){t(this.tape.save())},E.prototype.dispose=function(){this.tape=new k,this.count=0},x.prototype=Object.create(E.prototype),x.prototype.add=function(t){t.toBlob(function(t){E.prototype.add.call(this,t)}.bind(this),this.type)},L.prototype=Object.create(E.prototype),L.prototype.add=function(t){t.toBlob(function(t){E.prototype.add.call(this,t)}.bind(this),this.type,this.quality)},B.prototype=Object.create(i.prototype),B.prototype.add=function(t){this.stream||(this.stream=t.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()},B.prototype.save=function(t){this.mediaRecorder.onstop=function(e){var n=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],t(n)}.bind(this),this.mediaRecorder.stop()};var A=window.Date.now();return function(t){var e,n,i,r,o,s,a,f=t||{},l=[],u=[],d=0,m=0,g=[],w=!1,y={};f.framerate=f.framerate||60,f.motionBlurFrames=2*(f.motionBlurFrames||1),e=f.verbose||!1,f.display,f.step=1e3/f.framerate,f.timeLimit=f.timeLimit||0,f.frameLimit=f.frameLimit||0,f.startTime=f.startTime||0;var v=document.createElement("div");v.style.position="absolute",v.style.left=v.style.top=0,v.style.backgroundColor="black",v.style.fontFamily="monospace",v.style.fontSize="11px",v.style.padding="5px",v.style.color="red",v.style.zIndex=1e5,f.display&&document.body.appendChild(v);var b,k,E=document.createElement("canvas"),_=E.getContext("2d");R("Step is set to "+f.step+"ms");var T={gif:h,webm:c,ffmpegserver:p,png:x,jpg:L,"webm-mediarecorder":B},U=T[f.format];if(!U)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(T).join(", ");(a=new U(f)).step=s,a.on("process",q),a.on("progress",(function(t){!function(t){var e=y[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}("progress",t)}));var M=window.setTimeout,I=window.setInterval,D=window.clearInterval,O=window.clearTimeout,F=window.requestAnimationFrame,C=window.Date.now,S=window.performance.now,P=window.Date.prototype.getTime,N=[];function W(){w=!1,a.stop(),R("Capturer stop"),window.setTimeout=M,window.setInterval=I,window.clearInterval=D,window.clearTimeout=O,window.requestAnimationFrame=F,window.Date.prototype.getTime=P,window.Date.now=C,window.performance.now=S}function j(t,e){M(t,0,e)}function s(){j(q)}function q(){var t=1e3/f.framerate,e=(d+m/f.motionBlurFrames)*t;n=i+e,r=o+e,N.forEach((function(t){t._hookedTime=e/1e3})),function(){var t=d/f.framerate;(f.frameLimit&&d>=f.frameLimit||f.timeLimit&&t>=f.timeLimit)&&(W(),z());var e=new Date(null);e.setSeconds(t),f.motionBlurFrames>2?v.textContent="CCapture "+f.format+" | "+d+" frames ("+m+" inter) | "+e.toISOString().substr(11,8):v.textContent="CCapture "+f.format+" | "+d+" frames | "+e.toISOString().substr(11,8)}(),R("Frame: "+d+" "+m);for(var s=0;s<l.length;s++)n>=l[s].triggerTime&&(j(l[s].callback),l.splice(s,1));for(s=0;s<u.length;s++)n>=u[s].triggerTime&&(j(u[s].callback),u[s].triggerTime+=u[s].time);g.forEach((function(t){j(t,n-A)})),g=[]}function z(t){t||(t=function(t){return download(t,a.filename+a.extension,a.mimeType),!1}),a.save(t)}function R(t){e&&console.log(t)}return{start:function(){!function(){function t(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),N.push(this)),this._hookedTime+f.startTime}R("Capturer start"),i=window.Date.now(),n=i+f.startTime,o=window.performance.now(),r=o+f.startTime,window.Date.prototype.getTime=function(){return n},window.Date.now=function(){return n},window.setTimeout=function(t,e){var i={callback:t,time:e,triggerTime:n+e};return l.push(i),R("Timeout set to "+i.time),i},window.clearTimeout=function(t){for(var e=0;e<l.length;e++)l[e]!=t||(l.splice(e,1),R("Timeout cleared"))},window.setInterval=function(t,e){var i={callback:t,time:e,triggerTime:n+e};return u.push(i),R("Interval set to "+i.time),i},window.clearInterval=function(t){return R("clear Interval"),null},window.requestAnimationFrame=function(t){g.push(t)},window.performance.now=function(){return r};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:t}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:t})}catch(t){R(t)}}(),a.start(),w=!0},capture:function(t){w&&(f.motionBlurFrames>2?(function(t){E.width===t.width&&E.height===t.height||(E.width=t.width,E.height=t.height,b=new Uint16Array(E.height*E.width*4),_.fillStyle="#0",_.fillRect(0,0,E.width,E.height))}(t),function(t){_.drawImage(t,0,0),k=_.getImageData(0,0,E.width,E.height);for(var e=0;e<b.length;e+=4)b[e]+=k.data[e],b[e+1]+=k.data[e+1],b[e+2]+=k.data[e+2];m++}(t),m>=.5*f.motionBlurFrames?function(){for(var t=k.data,e=0;e<b.length;e+=4)t[e]=2*b[e]/f.motionBlurFrames,t[e+1]=2*b[e+1]/f.motionBlurFrames,t[e+2]=2*b[e+2]/f.motionBlurFrames;for(_.putImageData(k,0,0),a.add(E),d++,m=0,R("Full MB Frame! "+d+" "+n),e=0;e<b.length;e+=4)b[e]=0,b[e+1]=0,b[e+2]=0;gc()}():s()):(a.add(t),R("Full Frame! "+ ++d)))},stop:W,save:z,on:function(t,e){y[t]=e}}}}));